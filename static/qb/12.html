<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
    <a href="11.html">上一页</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="13.html">下一页</a>
<title>Django-4.0-Day12</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="37p3" id="django-40-day12">Django-4.0-Day12</h1><p data-anchor-id="hwbl"><code>django</code></p><hr><div class="md-section-divider"></div><h2 data-anchor-id="j1n1" id="01商品模块的授课思路">01_商品模块的授课思路</h2><ul data-anchor-id="6znj">
<li>商品相关数据模型设计 <br>
<ul><li>分析主页、列表页、详情页</li>
<li>SPU＆SKU</li>
<li>多表之间的关系</li></ul></li>
<li>图片数据存储 <br>
<ul><li>FastDFS</li>
<li>Docker</li>
<li>自定义django文件存储</li></ul></li>
<li>富文本编辑</li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="b77p" id="02广告页数据与商品类别数据表设计">02_广告页数据与商品类别数据表设计</h2><ul data-anchor-id="xdi8">
<li><p>SPU＆SKU</p>

<ul><li>SPU  <br>
Standard Product Unit （标准产品单位）</li>
<li>SKU <br>
Stock Keeping Unit （库存量单位）</li></ul></li>
<li><p>广告页 <br>
<img src="http://static.zybuluo.com/jsutqb/cb4re4tp69mym8qe32ai77al/image_1chlctbuc1j3s4el7u8n6n1vcdg.png" alt="image_1chlctbuc1j3s4el7u8n6n1vcdg.png-11.8kB"></p></li>
<li><p>商品类别 <br>
<img src="http://static.zybuluo.com/jsutqb/mv3fa2a343qzmarx76rseb3k/image_1chlctr8n1g7o1q781vpj83bthgt.png" alt="image_1chlctr8n1g7o1q781vpj83bthgt.png-10.3kB" title=""></p></li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="erq4" id="03商品表数据设计">03_商品表数据设计</h2><p data-anchor-id="6289"><img src="http://static.zybuluo.com/jsutqb/txkang9vgrw96diohg8cvjon/image_1chlfhihkmvt1ovg1s6s1p9ss3o1a.png" alt="image_1chlfhihkmvt1ovg1s6s1p9ss3o1a.png-87.7kB"></p><div class="md-section-divider"></div><h2 data-anchor-id="dbbv" id="04广告数据表与商品数据表的迁移">04_广告数据表与商品数据表的迁移</h2><ul data-anchor-id="jafq">
<li><p>商品 <br>
建立goods应用，注册goods应用</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="kwd">from</span><span class="pln"> django</span><span class="pun">.</span><span class="pln">db </span><span class="kwd">import</span><span class="pln"> models</span></code></li><li class="L1"><code><span class="kwd">from</span><span class="pln"> ckeditor</span><span class="pun">.</span><span class="pln">fields </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">RichTextField</span></code></li><li class="L2"><code><span class="kwd">from</span><span class="pln"> ckeditor_uploader</span><span class="pun">.</span><span class="pln">fields </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">RichTextUploadingField</span></code></li><li class="L3"><code><span class="kwd">from</span><span class="pln"> meiduo_mall</span><span class="pun">.</span><span class="pln">utils</span><span class="pun">.</span><span class="pln">models </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">BaseModel</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">GoodsCategory</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L6"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L7"><code><span class="str">    商品类别</span></code></li><li class="L8"><code><span class="str">    """</span></code></li><li class="L9"><code><span class="pln">    name </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'名称'</span><span class="pun">)</span></code></li><li class="L0"><code><span class="pln">    parent </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="str">'self'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> blank</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">CASCADE</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'父类别'</span><span class="pun">)</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Meta</span><span class="pun">:</span></code></li><li class="L3"><code><span class="pln">        db_table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tb_goods_category'</span></code></li><li class="L4"><code><span class="pln">        verbose_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'商品类别'</span></code></li><li class="L5"><code><span class="pln">        verbose_name_plural </span><span class="pun">=</span><span class="pln"> verbose_name</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __str__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L8"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">name</span></code></li><li class="L9"><code></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">GoodsChannel</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L2"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L3"><code><span class="str">    商品频道</span></code></li><li class="L4"><code><span class="str">    """</span></code></li><li class="L5"><code><span class="pln">    group_id </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">IntegerField</span><span class="pun">(</span><span class="pln">verbose_name</span><span class="pun">=</span><span class="str">'组号'</span><span class="pun">)</span></code></li><li class="L6"><code><span class="pln">    category </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">GoodsCategory</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">CASCADE</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'顶级商品类别'</span><span class="pun">)</span></code></li><li class="L7"><code><span class="pln">    url </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">50</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'频道页面链接'</span><span class="pun">)</span></code></li><li class="L8"><code><span class="pln">    sequence </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">IntegerField</span><span class="pun">(</span><span class="pln">verbose_name</span><span class="pun">=</span><span class="str">'组内顺序'</span><span class="pun">)</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Meta</span><span class="pun">:</span></code></li><li class="L1"><code><span class="pln">        db_table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tb_goods_channel'</span></code></li><li class="L2"><code><span class="pln">        verbose_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'商品频道'</span></code></li><li class="L3"><code><span class="pln">        verbose_name_plural </span><span class="pun">=</span><span class="pln"> verbose_name</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __str__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L6"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">category</span><span class="pun">.</span><span class="pln">name</span></code></li><li class="L7"><code></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">Brand</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L0"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L1"><code><span class="str">    品牌</span></code></li><li class="L2"><code><span class="str">    """</span></code></li><li class="L3"><code><span class="pln">    name </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">20</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'名称'</span><span class="pun">)</span></code></li><li class="L4"><code><span class="pln">    logo </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ImageField</span><span class="pun">(</span><span class="pln">verbose_name</span><span class="pun">=</span><span class="str">'Logo图片'</span><span class="pun">)</span></code></li><li class="L5"><code><span class="pln">    first_letter </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'品牌首字母'</span><span class="pun">)</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Meta</span><span class="pun">:</span></code></li><li class="L8"><code><span class="pln">        db_table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tb_brand'</span></code></li><li class="L9"><code><span class="pln">        verbose_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'品牌'</span></code></li><li class="L0"><code><span class="pln">        verbose_name_plural </span><span class="pun">=</span><span class="pln"> verbose_name</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __str__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L3"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">name</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">Goods</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L6"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L7"><code><span class="str">    商品SPU</span></code></li><li class="L8"><code><span class="str">    """</span></code></li><li class="L9"><code><span class="pln">    name </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">50</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'名称'</span><span class="pun">)</span></code></li><li class="L0"><code><span class="pln">    brand </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">Brand</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">PROTECT</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'品牌'</span><span class="pun">)</span></code></li><li class="L1"><code><span class="pln">    category1 </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">GoodsCategory</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">PROTECT</span><span class="pun">,</span><span class="pln"> related_name</span><span class="pun">=</span><span class="str">'cat1_goods'</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'一级类别'</span><span class="pun">)</span></code></li><li class="L2"><code><span class="pln">    category2 </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">GoodsCategory</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">PROTECT</span><span class="pun">,</span><span class="pln"> related_name</span><span class="pun">=</span><span class="str">'cat2_goods'</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'二级类别'</span><span class="pun">)</span></code></li><li class="L3"><code><span class="pln">    category3 </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">GoodsCategory</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">PROTECT</span><span class="pun">,</span><span class="pln"> related_name</span><span class="pun">=</span><span class="str">'cat3_goods'</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'三级类别'</span><span class="pun">)</span></code></li><li class="L4"><code><span class="pln">    sales </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">IntegerField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'销量'</span><span class="pun">)</span></code></li><li class="L5"><code><span class="pln">    comments </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">IntegerField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'评价数'</span><span class="pun">)</span></code></li><li class="L6"><code><span class="pln">    desc_detail </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">TextField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="str">''</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'详细介绍'</span><span class="pun">)</span></code></li><li class="L7"><code><span class="pln">    desc_pack </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">TextField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="str">''</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'包装信息'</span><span class="pun">)</span></code></li><li class="L8"><code><span class="pln">    desc_service </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">TextField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="str">''</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'售后服务'</span><span class="pun">)</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Meta</span><span class="pun">:</span></code></li><li class="L1"><code><span class="pln">        db_table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tb_goods'</span></code></li><li class="L2"><code><span class="pln">        verbose_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'商品'</span></code></li><li class="L3"><code><span class="pln">        verbose_name_plural </span><span class="pun">=</span><span class="pln"> verbose_name</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __str__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L6"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">name</span></code></li><li class="L7"><code></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">GoodsSpecification</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L0"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L1"><code><span class="str">    商品规格</span></code></li><li class="L2"><code><span class="str">    """</span></code></li><li class="L3"><code><span class="pln">    goods </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">Goods</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">CASCADE</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'商品'</span><span class="pun">)</span></code></li><li class="L4"><code><span class="pln">    name </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">20</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'规格名称'</span><span class="pun">)</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Meta</span><span class="pun">:</span></code></li><li class="L7"><code><span class="pln">        db_table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tb_goods_specification'</span></code></li><li class="L8"><code><span class="pln">        verbose_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'商品规格'</span></code></li><li class="L9"><code><span class="pln">        verbose_name_plural </span><span class="pun">=</span><span class="pln"> verbose_name</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __str__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L2"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'%s: %s'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">goods</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span></code></li><li class="L3"><code></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">SpecificationOption</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L6"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L7"><code><span class="str">    规格选项</span></code></li><li class="L8"><code><span class="str">    """</span></code></li><li class="L9"><code><span class="pln">    spec </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">GoodsSpecification</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">CASCADE</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'规格'</span><span class="pun">)</span></code></li><li class="L0"><code><span class="pln">    value </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">20</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'选项值'</span><span class="pun">)</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Meta</span><span class="pun">:</span></code></li><li class="L3"><code><span class="pln">        db_table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tb_specification_option'</span></code></li><li class="L4"><code><span class="pln">        verbose_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'规格选项'</span></code></li><li class="L5"><code><span class="pln">        verbose_name_plural </span><span class="pun">=</span><span class="pln"> verbose_name</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __str__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L8"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'%s - %s'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">spec</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span></code></li><li class="L9"><code></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="kwd">class</span><span class="pln"> SKU</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L2"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L3"><code><span class="str">    商品SKU</span></code></li><li class="L4"><code><span class="str">    """</span></code></li><li class="L5"><code><span class="pln">    name </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">50</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'名称'</span><span class="pun">)</span></code></li><li class="L6"><code><span class="pln">    caption </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">100</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'副标题'</span><span class="pun">)</span></code></li><li class="L7"><code><span class="pln">    goods </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">Goods</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">CASCADE</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'商品'</span><span class="pun">)</span></code></li><li class="L8"><code><span class="pln">    category </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">GoodsCategory</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">PROTECT</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'从属类别'</span><span class="pun">)</span></code></li><li class="L9"><code><span class="pln">    price </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">DecimalField</span><span class="pun">(</span><span class="pln">max_digits</span><span class="pun">=</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> decimal_places</span><span class="pun">=</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'单价'</span><span class="pun">)</span></code></li><li class="L0"><code><span class="pln">    cost_price </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">DecimalField</span><span class="pun">(</span><span class="pln">max_digits</span><span class="pun">=</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> decimal_places</span><span class="pun">=</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'进价'</span><span class="pun">)</span></code></li><li class="L1"><code><span class="pln">    market_price </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">DecimalField</span><span class="pun">(</span><span class="pln">max_digits</span><span class="pun">=</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> decimal_places</span><span class="pun">=</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'市场价'</span><span class="pun">)</span></code></li><li class="L2"><code><span class="pln">    stock </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">IntegerField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'库存'</span><span class="pun">)</span></code></li><li class="L3"><code><span class="pln">    sales </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">IntegerField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'销量'</span><span class="pun">)</span></code></li><li class="L4"><code><span class="pln">    comments </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">IntegerField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'评价数'</span><span class="pun">)</span></code></li><li class="L5"><code><span class="pln">    is_launched </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">BooleanField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'是否上架销售'</span><span class="pun">)</span></code></li><li class="L6"><code><span class="pln">    default_image_url </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">200</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">default</span><span class="pun">=</span><span class="str">''</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> blank</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'默认图片'</span><span class="pun">)</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Meta</span><span class="pun">:</span></code></li><li class="L9"><code><span class="pln">        db_table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tb_sku'</span></code></li><li class="L0"><code><span class="pln">        verbose_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'商品SKU'</span></code></li><li class="L1"><code><span class="pln">        verbose_name_plural </span><span class="pun">=</span><span class="pln"> verbose_name</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __str__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'%s: %s'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span></code></li><li class="L5"><code></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">SKUImage</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L8"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L9"><code><span class="str">    SKU图片</span></code></li><li class="L0"><code><span class="str">    """</span></code></li><li class="L1"><code><span class="pln">    sku </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="pln">SKU</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">CASCADE</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'sku'</span><span class="pun">)</span></code></li><li class="L2"><code><span class="pln">    image </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ImageField</span><span class="pun">(</span><span class="pln">verbose_name</span><span class="pun">=</span><span class="str">'图片'</span><span class="pun">)</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Meta</span><span class="pun">:</span></code></li><li class="L5"><code><span class="pln">        db_table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tb_sku_image'</span></code></li><li class="L6"><code><span class="pln">        verbose_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SKU图片'</span></code></li><li class="L7"><code><span class="pln">        verbose_name_plural </span><span class="pun">=</span><span class="pln"> verbose_name</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __str__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L0"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'%s %s'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">sku</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">id</span><span class="pun">)</span></code></li><li class="L1"><code></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">SKUSpecification</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L4"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L5"><code><span class="str">    SKU具体规格</span></code></li><li class="L6"><code><span class="str">    """</span></code></li><li class="L7"><code><span class="pln">    sku </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="pln">SKU</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">CASCADE</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'sku'</span><span class="pun">)</span></code></li><li class="L8"><code><span class="pln">    spec </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">GoodsSpecification</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">PROTECT</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'规格名称'</span><span class="pun">)</span></code></li><li class="L9"><code><span class="pln">    option </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">SpecificationOption</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">PROTECT</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'规格值'</span><span class="pun">)</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Meta</span><span class="pun">:</span></code></li><li class="L2"><code><span class="pln">        db_table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tb_sku_specification'</span></code></li><li class="L3"><code><span class="pln">        verbose_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SKU规格'</span></code></li><li class="L4"><code><span class="pln">        verbose_name_plural </span><span class="pun">=</span><span class="pln"> verbose_name</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __str__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'%s: %s - %s'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">sku</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">spec</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">option</span><span class="pun">.</span><span class="pln">value</span><span class="pun">)</span></code></li></ol></pre></li>
<li><p>广告(首页) <br>
建立contents应用，注册contents应用</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="kwd">from</span><span class="pln"> django</span><span class="pun">.</span><span class="pln">db </span><span class="kwd">import</span><span class="pln"> models</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="kwd">from</span><span class="pln"> meiduo_mall</span><span class="pun">.</span><span class="pln">utils</span><span class="pun">.</span><span class="pln">models </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">BaseModel</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">ContentCategory</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L5"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L6"><code><span class="str">    广告内容类别</span></code></li><li class="L7"><code><span class="str">    """</span></code></li><li class="L8"><code><span class="pln">    name </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">50</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'名称'</span><span class="pun">)</span></code></li><li class="L9"><code><span class="pln">    key </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">50</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'类别键名'</span><span class="pun">)</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Meta</span><span class="pun">:</span></code></li><li class="L2"><code><span class="pln">        db_table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tb_content_category'</span></code></li><li class="L3"><code><span class="pln">        verbose_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'广告内容类别'</span></code></li><li class="L4"><code><span class="pln">        verbose_name_plural </span><span class="pun">=</span><span class="pln"> verbose_name</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __str__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">name</span></code></li><li class="L8"><code></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">Content</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L1"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L2"><code><span class="str">    广告内容</span></code></li><li class="L3"><code><span class="str">    """</span></code></li><li class="L4"><code><span class="pln">    category </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="typ">ContentCategory</span><span class="pun">,</span><span class="pln"> on_delete</span><span class="pun">=</span><span class="pln">models</span><span class="pun">.</span><span class="pln">PROTECT</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'类别'</span><span class="pun">)</span></code></li><li class="L5"><code><span class="pln">    title </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">100</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'标题'</span><span class="pun">)</span></code></li><li class="L6"><code><span class="pln">    url </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">CharField</span><span class="pun">(</span><span class="pln">max_length</span><span class="pun">=</span><span class="lit">300</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'内容链接'</span><span class="pun">)</span></code></li><li class="L7"><code><span class="pln">    image </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">ImageField</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> blank</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'图片'</span><span class="pun">)</span></code></li><li class="L8"><code><span class="pln">    text </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">TextField</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> blank</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'内容'</span><span class="pun">)</span></code></li><li class="L9"><code><span class="pln">    sequence </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">IntegerField</span><span class="pun">(</span><span class="pln">verbose_name</span><span class="pun">=</span><span class="str">'排序'</span><span class="pun">)</span></code></li><li class="L0"><code><span class="pln">    status </span><span class="pun">=</span><span class="pln"> models</span><span class="pun">.</span><span class="typ">BooleanField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'是否展示'</span><span class="pun">)</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Meta</span><span class="pun">:</span></code></li><li class="L3"><code><span class="pln">        db_table </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tb_content'</span></code></li><li class="L4"><code><span class="pln">        verbose_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'广告内容'</span></code></li><li class="L5"><code><span class="pln">        verbose_name_plural </span><span class="pun">=</span><span class="pln"> verbose_name</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __str__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L8"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">category</span><span class="pun">.</span><span class="pln">name </span><span class="pun">+</span><span class="pln"> </span><span class="str">': '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">title</span></code></li></ol></pre></li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="ibvw" id="05fastdfs简介">05_FastDFS简介</h2><p data-anchor-id="wsft">FastDFS 为互联网量身定制的<strong>分布式</strong>文件系统。 </p><ul data-anchor-id="mpz9">
<li><p>优势</p>

<ul><li>海量存储(扩容方便)</li>
<li>重复文件只存一份</li>
<li>安全(支持集群)</li></ul></li>
<li><p>构成 <br>
<img src="http://static.zybuluo.com/jsutqb/g3ha45mz9aq2qj1aq74c2isk/image_1chlgt3rs1jiirn915n1u9g18kf1n.png" alt="image_1chlgt3rs1jiirn915n1u9g18kf1n.png-166.7kB"></p>

<ul><li>Tracker Server <br>
跟踪服务器  调度服务器 <br>
支持集群</li>
<li>Storage Server <br>
存储服务器 <br>
支持分组 和 集群</li></ul></li>
<li><p>流程 <br>
注意：这里的client不是浏览器</p>

<ul><li>上传 <br>
<img src="http://static.zybuluo.com/jsutqb/5w7j6b89h1q8i870edaa167o/image_1chlgumhcvub1j9ig8i6hgsk624.png" alt="image_1chlgumhcvub1j9ig8i6hgsk624.png-141.3kB"></li>
<li>下载 <br>
<img src="http://static.zybuluo.com/jsutqb/gbr7brluttd9yrwp2pwx8dyd/image_1chlgv1imdfn1tml18mc1vsfn582h.png" alt="image_1chlgv1imdfn1tml18mc1vsfn582h.png-128.2kB"></li></ul></li>
<li><p>简易的 <br>
1个Tracker <br>
1个Storage <br>
使用client进行操作(C、python)</p></li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="az9l" id="06虚拟化与docker简介">06_虚拟化与Docker简介</h2><ul data-anchor-id="ou9c">
<li><p>虚拟化 <br>
把实体资源(计算机)，变成多个虚拟实体</p></li>
<li><p>虚拟化种类 与 Docker</p>

<table class="table table-striped-white table-bordered">
<thead>
<tr>
 <th>虚拟化种类</th>
 <th>宿主OS</th>
 <th>虚拟硬件</th>
 <th>虚拟OS</th>
</tr>
</thead>
<tbody><tr>
 <td>全虚拟化架构</td>
 <td>√</td>
 <td>√</td>
 <td>√</td>
</tr>
<tr>
 <td>OS层虚拟化架构</td>
 <td>√</td>
 <td>×</td>
 <td>√</td>
</tr>
<tr>
 <td>硬件层虚拟化</td>
 <td>×</td>
 <td>√</td>
 <td>√</td>
</tr>
<tr>
 <td>Docker</td>
 <td>√</td>
 <td>×</td>
 <td>×</td>
</tr>
</tbody></table>
</li>
<li><p>Docker</p>

<ul><li>优势 <br>
<ol><li>文件小</li>
<li>启动块</li>
<li>易于集成</li></ol></li>
<li>特点 <br>
<ol><li>上手快</li>
<li>职责的逻辑分类</li>
<li>快速高效的开发生命周期</li>
<li>鼓励使用面向服务的架构</li></ol></li></ul></li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="evvv" id="07docker的概念">07_Docker的概念</h2><ul data-anchor-id="vuj0">
<li>概念 <br>
<ul><li>CS架构 <br>
存在一个运行的服务，通过向服务发送命令来进行操作</li>
<li>镜像 <br>
包含某些环境、应用程序的 文件</li>
<li>容器 <br>
镜像运行后的状态</li>
<li>Registry（注册中心） <br>
共享镜像的仓库，包含共有镜像、私有镜像。方便用户使用已经配置好的镜像。</li></ul></li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="dpxx" id="08docker安装">08_Docker安装</h2><p data-anchor-id="3uz4">参考文档 <br>
官方文档 <br>
<a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" target="_blank">https://docs.docker.com/install/linux/docker-ce/ubuntu/</a> <br>
清华大学 加速配置 <br>
<a href="https://mirror.tuna.tsinghua.edu.cn/help/docker-ce/" target="_blank">https://mirror.tuna.tsinghua.edu.cn/help/docker-ce/</a></p><ol data-anchor-id="kskp">
<li><p>准备工作</p>

<ol><li><p>更新ubuntu的apt源索引 <br>
<code>sudo apt-get update</code></p></li>
<li><p>安装包允许apt通过HTTPS使用仓库</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">sudo apt</span><span class="pun">-</span><span class="kwd">get</span><span class="pln"> install \</span></code></li><li class="L1"><code><span class="pln">    apt</span><span class="pun">-</span><span class="pln">transport</span><span class="pun">-</span><span class="pln">https \</span></code></li><li class="L2"><code><span class="pln">    ca</span><span class="pun">-</span><span class="pln">certificates \</span></code></li><li class="L3"><code><span class="pln">    curl \</span></code></li><li class="L4"><code><span class="pln">    software</span><span class="pun">-</span><span class="pln">properties</span><span class="pun">-</span><span class="pln">common</span></code></li></ol></pre></li>
<li><p>添加Docker官方GPG key <br>
可能需要翻墙 <br>
<code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</code> </p>

<p>免翻墙的 <br>
<code>curl -fsSL https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</code></p></li>
<li><p>设置Docker稳定版仓库 <br>
可能需要翻墙 </p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">sudo add</span><span class="pun">-</span><span class="pln">apt</span><span class="pun">-</span><span class="pln">repository \</span></code></li><li class="L1"><code><span class="pln">   </span><span class="str">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></code></li><li class="L2"><code><span class="str">   $(lsb_release -cs) \</span></code></li><li class="L3"><code><span class="str">   stable"</span></code></li></ol></pre>

<p>免翻墙的</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">sudo add</span><span class="pun">-</span><span class="pln">apt</span><span class="pun">-</span><span class="pln">repository \</span></code></li><li class="L1"><code><span class="pln">   </span><span class="str">"deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu \</span></code></li><li class="L2"><code><span class="str">   $(lsb_release -cs) \</span></code></li><li class="L3"><code><span class="str">   stable"</span></code></li></ol></pre></li>
<li><p>更新apt源索引 <br>
<code>sudo apt-get update</code></p></li></ol></li>
<li><p>安装最新版Docker CE（社区版） <br>
<code>sudo apt-get install docker-ce</code></p></li>
<li><p>检查Docker CE是否安装正确 <br>
<code>sudo docker run hello-world</code> <br>
出现如下信息，表示安装成功 <br>
<img src="http://static.zybuluo.com/jsutqb/zana3n9ntsibsvesqhhtkl4j/image_1chlmtfev1qrg8ba162h1q3c1lls3b.png" alt="image_1chlmtfev1qrg8ba162h1q3c1lls3b.png-481.7kB"></p></li>
<li><p>可选配置 <br>
为了避免每次命令都输入sudo，可以设置用户权限，注意执行后须注销重新登录 <br>
<code>sudo usermod -a -G docker $USER</code></p></li>
</ol><div class="md-section-divider"></div><h2 data-anchor-id="6qff" id="09docker镜像与容器的使用">09_Docker镜像与容器的使用</h2><ul data-anchor-id="mgz7">
<li><p>docker服务操作</p>

<ul><li>启动docker <br>
<code>sudo service docker start</code></li>
<li>停止docker <br>
<code>sudo service docker stop</code></li>
<li>重启docker <br>
<code>sudo service docker restart</code></li></ul></li>
<li><p>镜像操作 <br>
docker image  子命令 参数</p>

<ol><li>查看本机镜像 <br>
<code>docker image ls</code> <br>
<img src="http://static.zybuluo.com/jsutqb/y2msxja8gadfpocpfymvy8wh/image_1chlnaqf412ugukh1f9jnt115t93o.png" alt="image_1chlnaqf412ugukh1f9jnt115t93o.png-312.8kB"></li>
<li>下载镜像 <br>
<code>docker image pull 镜像名称或者id</code></li>
<li>删除镜像 <br>
<code>docker image rm 镜像名称或者id</code></li></ol></li>
<li><p>容器操作 <br>
docker container  自命令 参数</p>

<ol><li>列出活动容器 <br>
<code>docker container ls</code> <br>
<img src="http://static.zybuluo.com/jsutqb/9240jr0y4ojgulbsei2bl4n4/image_1chlnuica1e4ggnol916phc1i4i.png" alt="image_1chlnuica1e4ggnol916phc1i4i.png-16.3kB"></li>
<li><p>列出所有容器 <br>
<code>docker container ls -a</code> <br>
<img src="http://static.zybuluo.com/jsutqb/r75lm4fccdae0blnksboytfu/image_1chlnu2lppdbu7mmdb1c9f56t45.png" alt="image_1chlnu2lppdbu7mmdb1c9f56t45.png-52.5kB"></p></li>
<li><p><strong>创建容器</strong> <br>
<code>docker run [option] 镜像名 [向启动容器中传入的命令]</code></p>

<blockquote class="white-blockquote">
  <p>常用可选参数说明：</p>
  
  <p>-i 表示以“交互模式”运行容器 <br>
  -t 表示容器启动后会进入其命令行。加入这两个参数后，容器创建就能登录进去。即 分配一个伪终端。 <br>
  --name 为创建的容器命名 <br>
  -v 表示目录映射关系(前者是宿主机目录，后者是映射到宿主机上的目录，即 宿主机目录:容器中目录)，可以使 用多个-v 做多个目录或文件映射。注意:最好做目录映射，在宿主机上做修改，然后 共享到容器上。 <br>
  -d 在run后面加上-d参数,则会创建一个守护式容器在后台运行(这样创建容器后不 会自动登录容器，如果只加-i -t 两个参数，创建后就会自动进去容器)。 <br>
  -p 表示端口映射，前者是宿主机端口，后者是容器内的映射端口。可以使用多个-p 做多个端口映射 <br>
  -e 为容器设置环境变量 <br>
  --network=host 表示将主机的网络环境映射到容器中，容器的网络与主机相同</p>
</blockquote></li>
<li><p>删除容器 <br>
<code>docker container rm 容器名或容器id</code></p></li>
<li>启动容器 <br>
<code>docker container start 容器名或容器id</code></li>
<li>停止容器 <br>
<code>docker container stop 容器名或容器id</code></li>
<li>强行停止容器 <br>
<code>docker container kill 容器名或容器id</code></li></ol></li>
<li><p>高级</p>

<ul><li>将容器保存为镜像 <br>
<code>docker commit 容器名 镜像名</code></li>
<li>镜像备份与迁移 <br>
我们可以通过save命令将镜像打包成文件，拷贝给别人使用 <br>
<code>docker save -o 保存的文件名 镜像名</code></li>
<li>加载镜像文件 <br>
从别人那里拷贝到成型的镜像， 加载到本地 <br>
<code>docker load -i ./ubuntu.tar</code></li></ul></li>
<li><p>创建容器的几个例子</p>

<ol><li><p>交互式容器 <br>
创建一个交互式容器，并命名为myubuntu <br>
<code>docker run -it --name=myubuntu ubuntu /bin/bash</code></p></li>
<li><p>守护式容器 <br>
创建一个守护式容器:如果对于一个需要长期运行的容器来说，我们可以创建一个守护式容器。在容器内部exit退出时，容器也不会停止。 <br>
<code>docker run -dit --name=myubuntu2 ubuntu</code></p></li>
<li><p>特例 启动Tracker <br>
后台启动；网络环境同宿主机；宿主目录/var/fdfs/tracker=容器目录/var/fdfs <br>
<code>docker run -dti --network=host --name tracker -v /var/fdfs/tracker:/var/fdfs delron/fastdfs tracker</code></p></li>
<li>特例 启动Storage <br>
后台启动；网络环境同宿主机；添加环境变量 TRACKER_SERVER=10.211.55.5:22122 ；宿主目录/var/fdfs/storage=容器目录/var/fdfs <br>
<code>docker run -dti --network=host --name storage -e TRACKER_SERVER=10.211.55.5:22122 -v /var/fdfs/storage:/var/fdfs delron/fastdfs storage</code></li></ol></li>
<li><p>注意</p>

<ol><li>镜像删不掉 <br>
如果镜像已经被容器使用，是无法删除的，除非使用它的容器被删除</li>
<li>容器名称不能相同</li></ol></li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="id9a" id="10使用docker容器运行fastdfs的tracker和storage">10_使用Docker容器运行FastDFS的tracker和storage</h2><ul data-anchor-id="nwe9">
<li>步骤 <br>
<ol><li>获得镜像 <br>
两种方式 <br>
<ol><li>在线下载</li>
<li>使用文件</li></ol></li>
<li>启动 tracker <br>
<code>docker run -dti --network=host --name tracker -v /var/fdfs/tracker:/var/fdfs delron/fastdfs tracker</code></li>
<li>启动 Storage <br>
<code>docker run -dti --network=host --name storage -e TRACKER_SERVER=10.211.55.5:22122 -v /var/fdfs/storage:/var/fdfs delron/fastdfs storage</code> <br>
注意需要修改ip为本机ip</li>
<li>查看运行状态 <br>
<code>docker container ls</code></li></ol></li>
<li>注意 <br>
<ul><li>如果 Storage无法启动 <br>
<ol><li>删除宿主机的pid文件 <code>sudo rm /var/fdfs/storage/data/fdfs_storaged.pid</code> </li>
<li>重写启动storage 容器 <code>docker container start storage</code></li></ol></li></ul></li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="4kb9" id="11fastdfs客户端上传图片的使用">11_FastDFS客户端上传图片的使用</h2><ol data-anchor-id="2176">
<li><p>安装FastDFS的python版client</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln"> </span><span class="com"># 这个是安装本地文件</span></code></li><li class="L1"><code><span class="pln">pip install fdfs_client</span><span class="pun">-</span><span class="pln">py</span><span class="pun">-</span><span class="pln">master</span><span class="pun">.</span><span class="pln">zip</span></code></li><li class="L2"><code><span class="pln"> </span><span class="com"># 安装 fdfs_client的依赖</span></code></li><li class="L3"><code><span class="pln">pip install mutagen</span></code></li><li class="L4"><code><span class="pln">pip isntall requests</span></code></li></ol></pre></li>
<li><p>代码中使用client</p>

<ol><li><p>准备配置文件 client.conf</p>

<ol><li>放置到项目中的utils中</li>
<li><p>修改两个地方</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">base_path</span><span class="pun">=</span><span class="typ">FastDFS</span><span class="pun">客户端存放日志文件的目录</span></code></li><li class="L1"><code><span class="pln">tracker_server</span><span class="pun">=运行</span><span class="pln">tracker</span><span class="pun">服务的机器</span><span class="pln">ip</span><span class="pun">:</span><span class="lit">22122</span></code></li></ol></pre></li></ol></li>
<li><p>创建Client对象</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="kwd">from</span><span class="pln"> fdfs_client</span><span class="pun">.</span><span class="pln">client </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">Fdfs_client</span></code></li><li class="L1"><code><span class="pln">client </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Fdfs_client</span><span class="pun">(</span><span class="str">'client.conf文件的路径'</span><span class="pun">)</span></code></li></ol></pre></li>
<li><p>使用Client上传文件</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln"> </span><span class="com"># 指定文件路径上传</span></code></li><li class="L1"><code><span class="pln">client</span><span class="pun">.</span><span class="pln">upload_by_filename</span><span class="pun">(文件名)</span></code></li><li class="L2"><code><span class="pln"> </span><span class="com"># 指定文件内容上传，注意</span></code></li><li class="L3"><code><span class="pln"> </span><span class="com"># client.upload_by_buffer(文件bytes数据)</span></code></li></ol></pre></li>
<li><p>使用返回的结果</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> ret </span><span class="pun">=</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">upload_by_filename</span><span class="pun">(</span><span class="str">'/Users/delron/Desktop/1.png'</span><span class="pun">)</span></code></li><li class="L1"><code><span class="pln">getting connection</span></code></li><li class="L2"><code><span class="pun">&lt;</span><span class="pln">fdfs_client</span><span class="pun">.</span><span class="pln">connection</span><span class="pun">.</span><span class="typ">Connection</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> at </span><span class="lit">0x1098d4cc0</span><span class="pun">&gt;</span></code></li><li class="L3"><code><span class="pun">&lt;</span><span class="pln">fdfs_client</span><span class="pun">.</span><span class="pln">fdfs_protol</span><span class="pun">.</span><span class="typ">Tracker_header</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> at </span><span class="lit">0x1098d4908</span><span class="pun">&gt;</span></code></li><li class="L4"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> ret</span></code></li><li class="L5"><code><span class="pun">{</span><span class="str">'Group name'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'group1'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Remote file_id'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'group1/M00/00/02/CtM3BVr-k6SACjAIAAJctR1ennA809.png'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Status'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Upload successed.'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Local file name'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'/Users/delron/Desktop/1.png'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Uploaded size'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'151.00KB'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Storage IP'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'10.211.55.5'</span><span class="pun">}</span></code></li></ol></pre></li></ol></li>
</ol><div class="md-section-divider"></div><h2 data-anchor-id="spi4" id="12自定义django的文件存储系统">12_自定义Django的文件存储系统</h2><ul data-anchor-id="3ytx">
<li>文件存储 <br>
用户通过django后台上传的文件保存的方法 <br>
用户获得某个文件的方法</li>
<li>默认文件存储系统 <br>
django默认的文件存储系统 与 MEDIA_URL 和MEDIA_ROOT有关</li>
<li><p>自定义文件存储系统 <br>
我们可以使用自定义文件存储系统来代替</p>

<ul><li>步骤 <br>
<a href="https://yiyibooks.cn/xx/Django_1.11.6/howto/custom-file-storage.html" target="_blank">https://yiyibooks.cn/xx/Django_1.11.6/howto/custom-file-storage.html</a> <br>
<ol><li>定义类文件存储类 <br>
需要继承自django.core.files.storage.Storage</li>
<li>类上添加装饰 <br>
django.utils.deconstruct.deconstructible</li>
<li>配置类 <br>
<code>DEFAULT_FILE_STORAGE = '类的全路径'</code></li></ol></li></ul></li>
<li><p>代码实现</p>

<ol><li><p>定义类文件存储类 <br>
meiduo_mall.utils.fastdfs.fdfs_storage.py</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="kwd">from</span><span class="pln"> django</span><span class="pun">.</span><span class="pln">conf </span><span class="kwd">import</span><span class="pln"> settings</span></code></li><li class="L1"><code><span class="kwd">from</span><span class="pln"> django</span><span class="pun">.</span><span class="pln">core</span><span class="pun">.</span><span class="pln">files</span><span class="pun">.</span><span class="pln">storage </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">Storage</span></code></li><li class="L2"><code><span class="kwd">from</span><span class="pln"> django</span><span class="pun">.</span><span class="pln">core</span><span class="pun">.</span><span class="pln">exceptions </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">ImproperlyConfigured</span></code></li><li class="L3"><code><span class="kwd">from</span><span class="pln"> django</span><span class="pun">.</span><span class="pln">utils</span><span class="pun">.</span><span class="pln">deconstruct </span><span class="kwd">import</span><span class="pln"> deconstructible</span></code></li><li class="L4"><code><span class="kwd">from</span><span class="pln"> fdfs_client</span><span class="pun">.</span><span class="pln">client </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">Fdfs_client</span></code></li><li class="L5"><code></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="lit">@deconstructible</span></code></li><li class="L8"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">FasfDFSStorage</span><span class="pun">(</span><span class="typ">Storage</span><span class="pun">):</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __init__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span></code></li><li class="L1"><code><span class="pln">        </span><span class="str">"""</span></code></li><li class="L2"><code><span class="str">        初始化</span></code></li><li class="L3"><code><span class="str">        :param base_url: 用于构造图片完整路径使用，图片服务器的域名</span></code></li><li class="L4"><code><span class="str">        :param client_conf: FastDFS客户端配置文件的路径</span></code></li><li class="L5"><code><span class="str">        """</span></code></li><li class="L6"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln">  hasattr</span><span class="pun">(</span><span class="pln">settings</span><span class="pun">,</span><span class="str">"FDFS_URL"</span><span class="pun">):</span></code></li><li class="L7"><code><span class="pln">            </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">base_url </span><span class="pun">=</span><span class="pln"> settings</span><span class="pun">.</span><span class="pln">FDFS_URL</span></code></li><li class="L8"><code><span class="pln">        </span><span class="kwd">else</span><span class="pun">:</span></code></li><li class="L9"><code><span class="pln">            </span><span class="kwd">raise</span><span class="pln"> </span><span class="typ">ImproperlyConfigured</span><span class="pun">(</span><span class="str">"请配置FDFS_URL为Traker的地址"</span><span class="pun">)</span></code></li><li class="L0"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln">  hasattr</span><span class="pun">(</span><span class="pln">settings</span><span class="pun">,</span><span class="str">"FDFS_CLIENT_CONF"</span><span class="pun">):</span></code></li><li class="L1"><code><span class="pln">            </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">client_conf </span><span class="pun">=</span><span class="pln"> settings</span><span class="pun">.</span><span class="pln">FDFS_CLIENT_CONF</span></code></li><li class="L2"><code><span class="pln">        </span><span class="kwd">else</span><span class="pun">:</span></code></li><li class="L3"><code><span class="pln">            </span><span class="kwd">raise</span><span class="pln"> </span><span class="typ">ImproperlyConfigured</span><span class="pun">(</span><span class="str">"请配置FDFS_CLIENT_CONF为config文件路径的地址"</span><span class="pun">)</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> _open</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> mode</span><span class="pun">=</span><span class="str">'rb'</span><span class="pun">):</span></code></li><li class="L6"><code><span class="pln">        </span><span class="str">"""</span></code></li><li class="L7"><code><span class="str">        用不到打开文件(交给docker镜像中的nginx处理了)，所以省略</span></code></li><li class="L8"><code><span class="str">        """</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">pass</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> _save</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> content</span><span class="pun">):</span></code></li><li class="L2"><code><span class="pln">        </span><span class="str">"""</span></code></li><li class="L3"><code><span class="str">        在FastDFS中保存文件</span></code></li><li class="L4"><code><span class="str">        :param name: 传入的文件名</span></code></li><li class="L5"><code><span class="str">        :param content: 文件内容</span></code></li><li class="L6"><code><span class="str">        :return: 保存到数据库中的FastDFS的文件名</span></code></li><li class="L7"><code><span class="str">        """</span></code></li><li class="L8"><code><span class="pln">        client </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Fdfs_client</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">client_conf</span><span class="pun">)</span></code></li><li class="L9"><code><span class="pln">        ret </span><span class="pun">=</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">upload_by_buffer</span><span class="pun">(</span><span class="pln">content</span><span class="pun">.</span><span class="pln">read</span><span class="pun">())</span></code></li><li class="L0"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> ret</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"Status"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">"Upload successed."</span><span class="pun">:</span></code></li><li class="L1"><code><span class="pln">            </span><span class="kwd">raise</span><span class="pln"> </span><span class="typ">Exception</span><span class="pun">(</span><span class="str">"upload file failed"</span><span class="pun">)</span></code></li><li class="L2"><code><span class="pln">        file_name </span><span class="pun">=</span><span class="pln"> ret</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"Remote file_id"</span><span class="pun">)</span></code></li><li class="L3"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> file_name</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> url</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">):</span></code></li><li class="L6"><code><span class="pln">        </span><span class="str">"""</span></code></li><li class="L7"><code><span class="str">        返回文件的完整URL路径</span></code></li><li class="L8"><code><span class="str">        在使用ImageField的 url属性的时候，这个方法会被调用</span></code></li><li class="L9"><code><span class="str">        :param name: 数据库中保存的文件名</span></code></li><li class="L0"><code><span class="str">        :return: 完整的URL</span></code></li><li class="L1"><code><span class="str">        """</span></code></li><li class="L2"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">base_url </span><span class="pun">+</span><span class="pln"> name</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">def</span><span class="pln"> exists</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">):</span></code></li><li class="L5"><code><span class="pln">        </span><span class="str">"""</span></code></li><li class="L6"><code><span class="str">        判断文件是否存在，FastDFS可以自行解决文件的重名问题</span></code></li><li class="L7"><code><span class="str">        所以此处返回False，告诉Django上传的都是新文件</span></code></li><li class="L8"><code><span class="str">        :param name:  文件名</span></code></li><li class="L9"><code><span class="str">        :return: False</span></code></li><li class="L0"><code><span class="str">        """</span></code></li><li class="L1"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">False</span></code></li></ol></pre></li>
<li><p>配置类 <br>
<code>DEFAULT_FILE_STORAGE = 'meiduo_mall.utils.fastdfs.fdfs_storage.FasfDFSStorage'</code></p></li>
<li><p>配置FasfDFSStorage要求的选项</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">FDFS_URL </span><span class="pun">=</span><span class="pln"> </span><span class="str">'http://10.211.55.5:8888/'</span><span class="pln">  </span><span class="com"># 访问图片的路径域名 ip地址修改为自己机器的ip地址</span></code></li><li class="L1"><code><span class="pln">FDFS_CLIENT_CONF </span><span class="pun">=</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">BASE_DIR</span><span class="pun">,</span><span class="pln"> </span><span class="str">'utils/fastdfs/client.conf'</span><span class="pun">)</span></code></li></ol></pre></li></ol></li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="43fp" id="13ckeditor富文本编辑器的使用">13_ckeditor富文本编辑器的使用</h2><ul data-anchor-id="5sbq">
<li><p>富文本 <br>
允许用户在编辑内容的时候指定样式、添加图片等， 实际上编辑的不是普通文本，而是一个HTML</p></li>
<li><p>ckeditor富文本编辑器 <br>
强大的富文本编辑器，允许用户上传图片。可以</p></li>
<li><p>ckeditor的安装及配置</p>

<ol><li>安装 <br>
<code>pip install django-ckeditor</code></li>
<li><p>配置</p>

<ol><li><p>添加应用</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">INSTALLED_APPS </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">...</span></code></li><li class="L2"><code><span class="pln">    </span><span class="str">'ckeditor'</span><span class="pun">,</span><span class="pln">  </span><span class="com"># 富文本编辑器</span></code></li><li class="L3"><code><span class="pln">    </span><span class="str">'ckeditor_uploader'</span><span class="pun">,</span><span class="pln">  </span><span class="com"># 富文本编辑器上传图片模块</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">...</span></code></li><li class="L5"><code><span class="pun">]</span></code></li></ol></pre></li>
<li><p>配置url <br>
项目的urls.py <br>
<code>url(r'^ckeditor/', include('ckeditor_uploader.urls')),</code></p></li>
<li><p>配置富文本相关 <br>
settings.py/dev.py</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln"> </span><span class="com"># 富文本编辑器ckeditor配置</span></code></li><li class="L1"><code><span class="pln">CKEDITOR_CONFIGS </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="str">'default'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">        </span><span class="str">'toolbar'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'full'</span><span class="pun">,</span><span class="pln">  </span><span class="com"># 工具条功能</span></code></li><li class="L4"><code><span class="pln">        </span><span class="str">'height'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">300</span><span class="pun">,</span><span class="pln">  </span><span class="com"># 编辑器高度</span></code></li><li class="L5"><code><span class="pln">        </span><span class="com"># 'width': 300,  # 编辑器宽</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">},</span></code></li><li class="L7"><code><span class="pun">}</span></code></li><li class="L8"><code><span class="pln">CKEDITOR_UPLOAD_PATH </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pln">  </span><span class="com"># 上传图片保存路径，使用了FastDFS，所以此处设为''</span></code></li></ol></pre></li></ol></li></ol></li>
<li><p>使用</p>

<ol><li><p>修改模型类 <br>
给需要添加富文本的字段修改类型(视频中是添加字段)</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="kwd">from</span><span class="pln"> ckeditor</span><span class="pun">.</span><span class="pln">fields </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">RichTextField</span></code></li><li class="L1"><code><span class="kwd">from</span><span class="pln"> ckeditor_uploader</span><span class="pun">.</span><span class="pln">fields </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">RichTextUploadingField</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="kwd">class</span><span class="pln"> </span><span class="typ">Goods</span><span class="pun">(</span><span class="typ">BaseModel</span><span class="pun">):</span></code></li><li class="L4"><code><span class="pln">    </span><span class="str">"""</span></code></li><li class="L5"><code><span class="str">    商品SPU</span></code></li><li class="L6"><code><span class="str">    """</span></code></li><li class="L7"><code><span class="pln">    </span><span class="pun">...</span></code></li><li class="L8"><code><span class="pln">    </span><span class="com"># desc_detail = models.TextField(default='', verbose_name='详细介绍')</span></code></li><li class="L9"><code><span class="pln">    </span><span class="com"># desc_pack = models.TextField(default='', verbose_name='包装信息')</span></code></li><li class="L0"><code><span class="pln">    </span><span class="com"># desc_service = models.TextField(default='', verbose_name='售后服务')</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    desc_detail </span><span class="pun">=</span><span class="pln"> </span><span class="typ">RichTextUploadingField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="str">''</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'详细介绍'</span><span class="pun">)</span></code></li><li class="L3"><code><span class="pln">    desc_pack </span><span class="pun">=</span><span class="pln"> </span><span class="typ">RichTextField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="str">''</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'包装信息'</span><span class="pun">)</span></code></li><li class="L4"><code><span class="pln">    desc_service </span><span class="pun">=</span><span class="pln"> </span><span class="typ">RichTextUploadingField</span><span class="pun">(</span><span class="kwd">default</span><span class="pun">=</span><span class="str">''</span><span class="pun">,</span><span class="pln"> verbose_name</span><span class="pun">=</span><span class="str">'售后服务'</span><span class="pun">)</span></code></li></ol></pre>

<p>因为RichTextUploadingField -&gt; RichTextField -&gt; models.TextField 所以不涉及到表的修改</p></li></ol></li>
<li><p>注意 可能出现错误</p>

<ul><li>现象 <br>
<img src="http://static.zybuluo.com/jsutqb/hc7z5lzxrxkc64crug4i4lpc/image_1chlsp50oql6jsc1mfc11to1n834v.png" alt="image_1chlsp50oql6jsc1mfc11to1n834v.png-452kB"></li>
<li>原因 <br>
因为我们上传的时候就没有后缀，所以，在fdfs中存储的文件没有后缀导致 ckeditor出现错误</li>
<li><p>解决方式 <br>
两种</p>

<ol><li><p>修改ckeditor源码 <br>
~/.virtualenvs/meiduo/lib/python3.5/site-packages/ckeditor_uploader/views.py</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln"> </span><span class="com"># 95 行的样子</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln"> </span><span class="com"># if(str(saved_path).split('.')[1].lower() != 'gif'):</span></code></li><li class="L3"><code><span class="pln"> </span><span class="com">#           self._create_thumbnail_if_needed(backend, saved_path)</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="kwd">if</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">str</span><span class="pun">(</span><span class="pln">saved_path</span><span class="pun">).</span><span class="pln">split</span><span class="pun">(</span><span class="str">'.'</span><span class="pun">))&gt;</span><span class="lit">1</span><span class="pun">:</span></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">str</span><span class="pun">(</span><span class="pln">saved_path</span><span class="pun">).</span><span class="pln">split</span><span class="pun">(</span><span class="str">'.'</span><span class="pun">)[</span><span class="lit">1</span><span class="pun">].</span><span class="pln">lower</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">'gif'</span><span class="pun">):</span></code></li><li class="L7"><code><span class="pln">              </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">_create_thumbnail_if_needed</span><span class="pun">(</span><span class="pln">backend</span><span class="pun">,</span><span class="pln"> saved_path</span><span class="pun">)</span></code></li></ol></pre></li>
<li>上传内容时指定文件扩展名 <br>
<code>def upload_by_buffer(self, filebuffer, file_ext_name=None)</code></li></ol></li></ul></li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="x8oi" id="14测试与bug解决">14_测试与bug解决</h2><ul data-anchor-id="g24i">
<li><p>测试 <br>
测试富文本和图片上传</p>

<ol><li><p>注册模型类</p>

<ul><li><p>contents.admin.py</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="kwd">from</span><span class="pln"> django</span><span class="pun">.</span><span class="pln">contrib </span><span class="kwd">import</span><span class="pln"> admin</span></code></li><li class="L1"><code><span class="kwd">from</span><span class="pln"> </span><span class="pun">.</span><span class="pln"> </span><span class="kwd">import</span><span class="pln"> models</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">admin</span><span class="pun">.</span><span class="pln">site</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">models</span><span class="pun">.</span><span class="typ">ContentCategory</span><span class="pun">)</span></code></li><li class="L4"><code><span class="pln">admin</span><span class="pun">.</span><span class="pln">site</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">models</span><span class="pun">.</span><span class="typ">Content</span><span class="pun">)</span></code></li></ol></pre></li>
<li><p>goods.admin.py</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="kwd">from</span><span class="pln"> django</span><span class="pun">.</span><span class="pln">contrib </span><span class="kwd">import</span><span class="pln"> admin</span></code></li><li class="L1"><code><span class="kwd">from</span><span class="pln"> </span><span class="pun">.</span><span class="pln"> </span><span class="kwd">import</span><span class="pln"> models</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">admin</span><span class="pun">.</span><span class="pln">site</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">models</span><span class="pun">.</span><span class="typ">GoodsCategory</span><span class="pun">)</span></code></li><li class="L4"><code><span class="pln">admin</span><span class="pun">.</span><span class="pln">site</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">models</span><span class="pun">.</span><span class="typ">GoodsChannel</span><span class="pun">)</span></code></li><li class="L5"><code><span class="pln">admin</span><span class="pun">.</span><span class="pln">site</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">models</span><span class="pun">.</span><span class="typ">Goods</span><span class="pun">)</span></code></li><li class="L6"><code><span class="pln">admin</span><span class="pun">.</span><span class="pln">site</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">models</span><span class="pun">.</span><span class="typ">Brand</span><span class="pun">)</span></code></li><li class="L7"><code><span class="pln">admin</span><span class="pun">.</span><span class="pln">site</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">models</span><span class="pun">.</span><span class="typ">GoodsSpecification</span><span class="pun">)</span></code></li><li class="L8"><code><span class="pln">admin</span><span class="pun">.</span><span class="pln">site</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">models</span><span class="pun">.</span><span class="typ">SpecificationOption</span><span class="pun">)</span></code></li><li class="L9"><code><span class="pln">admin</span><span class="pun">.</span><span class="pln">site</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">models</span><span class="pun">.</span><span class="pln">SKU</span><span class="pun">)</span></code></li><li class="L0"><code><span class="pln">admin</span><span class="pun">.</span><span class="pln">site</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">models</span><span class="pun">.</span><span class="typ">SKUSpecification</span><span class="pun">)</span></code></li><li class="L1"><code><span class="pln">admin</span><span class="pun">.</span><span class="pln">site</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">models</span><span class="pun">.</span><span class="typ">SKUImage</span><span class="pun">)</span></code></li></ol></pre></li></ul></li>
<li>创建超级用户</li>
<li>后台使用富文本、图片上传</li></ol></li>
<li><p>项目数据准备</p>

<ol><li>把商品相关数据通过sql脚本导入mysql数据库 <br>
mysql -uroot -pmysql meiduo_mall &lt; goods_data.sql</li>
<li>准备项目图片 <br>
<ol><li>拷贝data.tar.gz到/var/fdfs/storage</li>
<li>解压 <code>tar -zxvf data.tar.gz</code></li></ol></li></ol></li>
</ul></div>
<a href="11.html">上一页</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="13.html">下一页</a>
</body>
</html>